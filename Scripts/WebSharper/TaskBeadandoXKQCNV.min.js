(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;a=self;b=a.TaskBeadandoXKQCNV=a.TaskBeadandoXKQCNV||{};c=b.Radius=b.Radius||{};d=b.Pathfind=b.Pathfind||{};e=d.Node=d.Node||{};f=a.StartupCode$TaskBeadandoXKQCNV$Pathfind=a.StartupCode$TaskBeadandoXKQCNV$Pathfind||{};g=b.Client=b.Client||{};h=a.StartupCode$TaskBeadandoXKQCNV$Client=a.StartupCode$TaskBeadandoXKQCNV$Client||{};i=a.WebSharper;j=i&&i.Operators;k=i&&i.Enumerator;l=a.IntelliFactory;m=l&&l.Runtime;n=i&&i.Arrays2D;o=a.console;p=i&&i.Unchecked;q=i&&i.Arrays;r=a.Math;s=i&&i.UI;t=s&&s.Doc;u=s&&s.AttrProxy;v=i&&i.Strings;w=i&&i.Html;x=w&&w.Client;y=x&&x.Operators;z=x&&x.Attr;A=x&&x.Tags;B=x&&x.EventsPervasives;C=s&&s.Var$1;c.RadiusCheck=function(D,E,F,G,H){var I,J,K,L,M,N,O,P,Q,R;I=0;J=0;K=0;L=0;D-H<0?void(I=0):void(I=D-H);E-H<0?void(J=0):void(J=E-H);D+H>=F?void(K=F-1):void(K=D+H);E+H>=G?void(L=G-1):void(L=E+H);M=[];N=j.step(I,1,K);O=k.Get(N);try{while(O.MoveNext()){P=O.Current();Q=j.step(J,1,L);R=k.Get(Q);try{while(R.MoveNext())M.push([P,R.Current()]);}finally{if(typeof R=="object"&&"Dispose"in R)R.Dispose();}}}finally{if(typeof O=="object"&&"Dispose"in O)O.Dispose();}return M;};e=d.Node=m.Class({CalculateFCost:function(){this.FCost=this.GCost+this.HCost;}},null,e);e.New=function(D,E,F,G,H,I,J,K){return new e({AxisX:D,AxisY:E,HCost:F,GCost:G,FCost:H,OpenList:I,ClosedList:J,Walkable:K});};d.CreatePath=function(D,E,F,G,H,I,J,K){var L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb;d.set_lengthX(E);d.set_lengthY(F);L=n.init(d.lengthX(),d.lengthY(),function(){return 0;});M=false;d.set_ReachedEnd(false);o.log("Start of Pathfind");o.log("Validation check");if(p.Equals(d.InputValid(G,H,I,J),true)){o.log("Node stuff starts");d.set_Nodes(n.init(d.lengthX(),d.lengthY(),function(){return e.New(0,0,0,0,0,false,false,true);}));o.log("Node stuff ended");for(P=0,Q=d.lengthX()-1;P<=Q;P++){for(R=0,S=d.lengthY()-1;R<=S;R++){q.get2D(d.Nodes(),P,R).HCost=r.abs(P-I)-r.abs(R-J);q.get2D(d.Nodes(),P,R).AxisX=P;q.get2D(d.Nodes(),P,R).AxisY=R;if(q.get2D(D,P,R).Alpha>0){T=c.RadiusCheck(P,R,d.lengthX(),d.lengthY(),K);for(U=0,V=q.length(T)-1;U<=V;U++)q.get2D(d.Nodes(),(q.get(T,U))[0],(q.get(T,U))[1]).Walkable=false;q.get2D(d.Nodes(),P,R).Walkable=false;}else void 0;}}o.log("Calculations ended for HCost, time for first node");q.get2D(d.Nodes(),G,H).GCost=d.MovementCost();q.get2D(d.Nodes(),G,H).CalculateFCost();q.get2D(d.Nodes(),G,H).OpenList=true;o.log("First node calculate:");W=d.NeighborNodes(G,H,true,I,J);o.log(W);N=false;O=0;while(p.Equals(M,false)){o.log("We started the maz, this should only appear once");while(!d.ReachedEnd()&&!N){_0=0;_1=0;_2=d.lengthX()*d.lengthY()*10;for(_3=0,_4=d.lengthX()-1;_3<=_4;_3++){for(_5=0,_6=d.lengthY()-1;_5<=_6;_5++)if(q.get2D(d.Nodes(),_3,_5).FCost!==0&&q.get2D(d.Nodes(),_3,_5).FCost<_2&&p.Equals(q.get2D(d.Nodes(),_3,_5).OpenList,true)&&p.Equals(q.get2D(d.Nodes(),_3,_5).ClosedList,false)){_2=q.get2D(d.Nodes(),_3,_5).FCost;_0=_3;_1=_5;}}q.get2D(d.Nodes(),_0,_1).ClosedList=true;d.NeighborNodes(q.get2D(d.Nodes(),_0,_1).AxisX,q.get2D(d.Nodes(),_0,_1).AxisY,false,I,J);O===d.lengthX()*d.lengthY()?(a.alert("Couldn't generate path!"),d.set_ReachedEnd(true),N=true,M=true):void 0;O=O+1;}if(p.Equals(N,false)){X=false;_7=[];Z=d.NeighborNodes(I,J,true,I,J);O=0;while(p.Equals(X,false)){_8=null;_9=d.lengthX()*d.lengthY()*9999;for(_=0,$=q.length(Z)-1;_<=$;_++)if(_9>q.get(Z,_).FCost){_9=q.get(Z,_).FCost;_8=q.get(Z,_);}_7.push(_8);Z=d.NeighborNodes(_8.AxisX,_8.AxisY,true,I,J);_8.AxisX===G&&_8.AxisY===H?X=true:O===d.lengthX()*d.lengthY()?M=true:void 0;O=O+1;}for(ba=0,bb=q.length(_7)-1;ba<=bb;ba++)q.set2D(L,q.get(_7,ba).AxisX,q.get(_7,ba).AxisY,q.length(_7)-ba-1);M=true;}else M=true;}}else null;o.log("Returning stuff");return L;};d.InputValid=function(D,E,F,G){o.log("Calculating Valid Path");return D===F&&E===G?(o.log("Calculated"),false):(o.log("Calculated"),true);};d.NeighborNodes=function(D,E,F,G,H){var I,J,K,L,M;function N(O,P,Q){if(p.Equals(F,false)&&p.Equals(q.get2D(d.Nodes(),O,P).Walkable,true)&&!p.Equals(q.get2D(d.Nodes(),O,P).ClosedList,true))I.push(d.NeighborNodesFound(O,P,Q,D,E,G,H));else if(p.Equals(q.get2D(d.Nodes(),O,P).Walkable,true))I.push(d.NeighborNodesFound(O,P,Q,D,E,G,H));}I=[];J=!(D+1>=d.lengthX());K=D-1>=0;L=!(E+1>=d.lengthY());M=E-1>=0;J?N(D+1,E,false):void 0;K?N(D-1,E,false):void 0;L?N(D,E+1,false):void 0;M?N(D,E-1,false):void 0;J&&M?N(D+1,E-1,true):void 0;J&&L?N(D+1,E+1,true):void 0;K&&M?N(D-1,E-1,true):void 0;K&&L?N(D-1,E+1,true):void 0;return I;};d.NeighborNodesFound=function(D,E,F,G,H,I,J){var K;o.log("Calculating neighbors");q.get2D(d.Nodes(),D,E).OpenList=true;q.get2D(d.Nodes(),D,E).GCost===0?p.Equals(F,true)?q.get2D(d.Nodes(),D,E).GCost=q.get2D(d.Nodes(),G,H).GCost+d.MovementCost()+4:q.get2D(d.Nodes(),D,E).GCost=q.get2D(d.Nodes(),G,H).GCost+d.MovementCost():void 0;q.get2D(d.Nodes(),D,E).CalculateFCost();K=q.get2D(d.Nodes(),D,E);D===I&&E===J?d.set_ReachedEnd(true):void 0;o.log("Returning");return K;};d.Nodes=function(){f.$cctor();return f.Nodes;};d.set_Nodes=function(D){f.$cctor();f.Nodes=D;};d.lengthY=function(){f.$cctor();return f.lengthY;};d.set_lengthY=function(D){f.$cctor();f.lengthY=D;};d.lengthX=function(){f.$cctor();return f.lengthX;};d.set_lengthX=function(D){f.$cctor();f.lengthX=D;};d.MovementCost=function(){f.$cctor();return f.MovementCost;};d.ReachedEnd=function(){f.$cctor();return f.ReachedEnd;};d.set_ReachedEnd=function(D){f.$cctor();f.ReachedEnd=D;};f.$cctor=function(){f.$cctor=a.ignore;f.ReachedEnd=false;f.MovementCost=10;f.lengthX=0;f.lengthY=0;f.Nodes=null;};g.Main=function(){return t.Element("div",[u.Create("style","text-align: center; ")],[t.Button("Pick Start",[u.Create("style","background: #a8ffa8;color:black;")],function(){g.set_brushMode(2);}),t.Button("Pick End",[u.Create("style","background: #aba8ff;color:black;")],function(){g.set_brushMode(3);}),t.Element("table",[],[t.Element("th",[],[t.Element("tr",[],[t.Element("h3",[],[t.TextNode("Brush size:")]),t.Input([u.Create("style","width:75px"),u.Create("type","range"),u.Create("min","2"),u.Create("max","15"),u.Create("class","slider")],g.brushSize()),t.Element("h3",[],[t.TextNode("Collision Size:")]),t.Input([u.Create("style","width:75px"),u.Create("type","range"),u.Create("min","1"),u.Create("max","5"),u.Create("class","slider")],g.collisionSize())]),t.Element("tr",[],[t.Element("h2",[],[t.TextNode("Toggle brush types:")]),t.Button("",[u.Create("style","color:#a434b3;"),u.Create("class","fa fa-eraser")],function(){g.set_brushMode(1);}),t.Button("",[u.Create("style","color:#b35034;"),u.Create("class","fa fa-edit")],function(){g.set_brushMode(0);})]),t.Element("tr",[],[t.Button("Create path!",[],function(){var D,E,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V;function F(){D=D+1;}g.clearStart();g.clearEnd();g.set_CachedCanvas(g.ctx().getImageData(0,0,g.canvas().width,g.canvas().height));G=g.CachedCanvas().data;H=v.SplitChars(a.String(G),[","],0);I=n.init(g.canvas().width,g.canvas().height,function(){return{Red:0,Green:0,Blue:0,Alpha:0};});D=0;J=j.step(0,1,g.canvas().width-1);K=k.Get(J);try{while(K.MoveNext()){L=K.Current();M=j.step(0,1,g.canvas().height-1);N=k.Get(M);try{while(N.MoveNext()){O=N.Current();q.get2D(I,L,O).Red=j.toInt(a.Number(q.get(H,D)));F();q.get2D(I,L,O).Green=j.toInt(a.Number(q.get(H,D)));F();q.get2D(I,L,O).Blue=j.toInt(a.Number(q.get(H,D)));F();q.get2D(I,L,O).Alpha=j.toInt(a.Number(q.get(H,D)));F();}}finally{if(typeof N=="object"&&"Dispose"in N)N.Dispose();}}}finally{if(typeof K=="object"&&"Dispose"in K)K.Dispose();}o.log(a.String(G));o.log(G);g.canvas().height=g.canvas().height;g.canvas().width=g.canvas().width;o.log(g.canvas().height);o.log(g.canvas().width);P=d.CreatePath(I,g.canvas().height,g.canvas().width,g.startX(),g.startY(),g.endX(),g.endY(),j.toInt(a.Number(g.collisionSize().Get())));o.log("Time to draw");g.restoreCache();g.drawStart();g.drawEnd();Q=j.step(0,1,g.canvas().width-1);R=k.Get(Q);try{while(R.MoveNext()){S=R.Current();T=j.step(0,1,g.canvas().height-1);U=k.Get(T);try{while(U.MoveNext()){V=U.Current();q.get2D(P,S,V)>0?(g.ctx().fillStyle="red",g.ctx().fillRect(V,S,1,1)):void 0;}}finally{if(typeof U=="object"&&"Dispose"in U)U.Dispose();}}}finally{if(typeof R=="object"&&"Dispose"in R)R.Dispose();}g.ctx().lineCap="round";})]),t.Element("tr",[],[t.Element("h3",[u.Create("style","text-align: center;")],[t.TextNode("Auto pathfind:")]),t.CheckBox([u.Create("style","text-align: center;\r\n                    vertical-align: middle;\r\n                    margin-left: 50px;")],g.autoPathfind())])])]),t.Element("br",[],[]),t.Button("Debug",[],function(){g.restoreCache();}),t.Element("div",[],[t.Element("h1",[],[t.TextNode("Edit map")]),t.Element("table",[],[t.Element("tr",[],[t.Element("td",[],[t.Element("h3",[],[t.TextNode("Map Size:")]),t.Input([u.Create("style","width:100px"),u.Create("type","range"),u.Create("min","20"),u.Create("max","100"),u.Create("class","slider")],g.MapSize())]),t.Element("td",[],[t.Button("Reset/Clear",[u.Create("style","background: red;color:white;")],function(){g.set_CachedCanvas(null);g.canvas().height=j.toInt(a.Number(g.MapSize().Get()));g.canvas().width=j.toInt(a.Number(g.MapSize().Get()));g.ctx().lineCap="round";g.draw();})])])])])]);};g.Canvas=function(){var D,E,F,G,H,I;function J(O,P){var Q,R,S;Q=g.getXYFromMouseEvent(O,P);R=Q[1];S=Q[0];g.updatePos(S,R);(g.lastX())[0]=S;(g.lastY())[0]=R;(g.inLine())[0]=true;g.ctx().beginPath();g.ctx().strokeStyle="#000000";g.ctx().fillStyle="#000000";return g.draw();}function K(O,P){var Q;(g.inLine())[0]=false;Q=g.getXYFromMouseEvent(O,P);return g.updatePos(Q[0],Q[1]);}function L(O,P){var Q,R,S,T,U;Q=g.getXYFromMouseEvent(O,P);R=Q[1];S=Q[0];g.updatePos(S,R);return(g.inLine())[0]?(g.ctx().moveTo((g.lastX())[0],(g.lastY())[0]),g.ctx().lineTo(S,R),g.ctx().lineWidth=a.Number(g.brushSize().Get()),g.brushMode()===0?g.ctx().stroke():void 0,g.brushMode()===1?(T=a.Number(g.brushSize().Get()),U=a.Number(g.brushSize().Get())+T,g.ctx().clearRect(S+T-U,R+T-U,U,U)):void 0,g.brushMode()===2?(g.clearStart(),g.set_startX(S),g.set_startY(R)):void 0,g.brushMode()===3?(g.clearEnd(),g.set_endX(S),g.set_endY(R)):void 0,(g.lastX())[0]=S,(g.lastY())[0]=R,g.draw()):null;}function M(O,P){var Q;Q=g.getXYFromMouseEvent(O,P);g.updatePos(Q[0],Q[1]);g.restoreCache();g.drawStart();return g.drawEnd();}function N(O,P){(g.inLine())[0]=false;return g.set_CachedCanvas(g.ctx().getImageData(0,0,g.canvas().width,g.canvas().height));}g.draw();return y.add((D=[z.Attr().NewAttr("class","zoom"),z.Attr().NewAttr("style","\r\n        width:300px;\r\n        border: 4px;\r\n        text-align: center; \r\n        cursor: crosshair;\r\n        image-rendering: crisp-edges;\r\n        -ms-interpolation-mode: nearest-neighbor;\r\n        ")],A.Tags().NewTag("div",D)),[g.labelPos(),A.Tags().NewTag("br",[]),(E=(F=(G=(H=(I=g.element(),(function(O){B.Events().OnMouseDown(function(P){return function(Q){return J(P,Q);};},O);}(I),I)),(function(O){B.Events().OnMouseUp(function(P){return function(Q){return K(P,Q);};},O);}(H),H)),(function(O){B.Events().OnMouseMove(function(P){return function(Q){return L(P,Q);};},O);}(G),G)),(function(O){B.Events().OnMouseEnter(function(P){return function(Q){return M(P,Q);};},O);}(F),F)),(function(O){B.Events().OnMouseLeave(function(P){return function(Q){return N(P,Q);};},O);}(E),E))]);};g.restoreCache=function(){g.ctx().putImageData(g.CachedCanvas(),0,0);};g.draw=function(){g.drawStart();g.drawEnd();};g.clearEnd=function(){g.ctx().clearRect(g.endX(),g.endY(),g.BorderSize(),g.BorderSize());};g.drawEnd=function(){g.ctx().fillStyle="#0000ff";g.ctx().fillRect(g.endX(),g.endY(),g.BorderSize(),g.BorderSize());};g.clearStart=function(){g.ctx().clearRect(g.startX(),g.startY(),g.BorderSize(),g.BorderSize());};g.drawStart=function(){g.ctx().fillStyle="#00ff00";g.ctx().fillRect(g.startX(),g.startY(),g.BorderSize(),g.BorderSize());};g.ctx=function(){h.$cctor();return h.ctx;};g.canvas=function(){h.$cctor();return h.canvas;};g.getXYFromMouseEvent=function(D,E){var F;F=a.jQuery(D.get_Body()).position();return[E.X-j.toInt(F.left),E.Y-j.toInt(F.top)];};g.updatePos=function(D,E){var F,G;F=g.labelPos();F.HtmlProvider.Clear(F.get_Body());G=g.labelPos();G.HtmlProvider.AppendNode(G.get_Body(),G.HtmlProvider.CreateTextNode("X="+a.String(D)+", Y="+a.String(E)));};g.labelPos=function(){h.$cctor();return h.labelPos;};g.inLine=function(){h.$cctor();return h.inLine;};g.lastX=function(){h.$cctor();return h.lastX;};g.lastY=function(){h.$cctor();return h.lastY;};g.element=function(){h.$cctor();return h.element;};g.MapSize=function(){h.$cctor();return h.MapSize;};g.CachedCanvas=function(){h.$cctor();return h.CachedCanvas;};g.set_CachedCanvas=function(D){h.$cctor();h.CachedCanvas=D;};g.autoPathfind=function(){h.$cctor();return h.autoPathfind;};g.collisionSize=function(){h.$cctor();return h.collisionSize;};g.brushMode=function(){h.$cctor();return h.brushMode;};g.set_brushMode=function(D){h.$cctor();h.brushMode=D;};g.brushSize=function(){h.$cctor();return h.brushSize;};g.endY=function(){h.$cctor();return h.endY;};g.set_endY=function(D){h.$cctor();h.endY=D;};g.endX=function(){h.$cctor();return h.endX;};g.set_endX=function(D){h.$cctor();h.endX=D;};g.startY=function(){h.$cctor();return h.startY;};g.set_startY=function(D){h.$cctor();h.startY=D;};g.startX=function(){h.$cctor();return h.startX;};g.set_startX=function(D){h.$cctor();h.startX=D;};g.BorderSize=function(){h.$cctor();return h.BorderSize;};g.initialOffset=function(){h.$cctor();return h.initialOffset;};g.initialSize=function(){h.$cctor();return h.initialSize;};h.$cctor=function(){var D,E;h.$cctor=a.ignore;h.initialSize=50;h.initialOffset=3;h.BorderSize=3;h.startX=g.initialOffset();h.startY=g.initialOffset();h.endX=g.initialSize()-g.initialOffset();h.endY=g.initialSize()-g.initialOffset();h.brushSize=C.Create$1(a.String(2));h.brushMode=0;h.collisionSize=C.Create$1(a.String(1));h.autoPathfind=C.Create$1(false);h.CachedCanvas=null;h.MapSize=C.Create$1(a.String(g.initialSize()));h.element=A.Tags().NewTag("canvas",[]);D=[[0],[0],[false]];h.lastY=D[1];h.lastX=D[0];h.inLine=D[2];h.labelPos=(E=[A.Tags().text("Position:")],A.Tags().NewTag("span",E));h.canvas=g.element().Dom;g.canvas().height=j.toInt(a.Number(g.MapSize().Get()));g.canvas().width=j.toInt(a.Number(g.MapSize().Get()));h.ctx=g.canvas().getContext("2d");g.ctx().lineCap="round";};m.OnLoad(function(){g.Canvas();});}());
