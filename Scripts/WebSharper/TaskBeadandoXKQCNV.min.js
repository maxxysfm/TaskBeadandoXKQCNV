(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;a=self;b=a.TaskBeadandoXKQCNV=a.TaskBeadandoXKQCNV||{};c=b.Client=b.Client||{};d=a.StartupCode$TaskBeadandoXKQCNV$Client=a.StartupCode$TaskBeadandoXKQCNV$Client||{};e=a.WebSharper;f=e&&e.UI;g=f&&f.Doc;h=f&&f.AttrProxy;i=e&&e.Strings;j=e&&e.Arrays2D;k=e&&e.Operators;l=e&&e.Enumerator;m=e&&e.Arrays;n=a.console;o=e&&e.Html;p=o&&o.Client;q=p&&p.Operators;r=p&&p.Attr;s=p&&p.Tags;t=p&&p.EventsPervasives;u=f&&f.Var$1;v=a.IntelliFactory;w=v&&v.Runtime;c.Main=function(){return g.Element("div",[h.Create("style","text-align: center; ")],[g.Button("Pick Start",[h.Create("style","background: #a8ffa8;color:black;")],function(){c.set_brushMode(2);}),g.Button("Pick End",[h.Create("style","background: #aba8ff;color:black;")],function(){c.set_brushMode(3);}),g.Element("table",[],[g.Element("th",[],[g.Element("tr",[],[g.Element("h3",[],[g.TextNode("Brush size:")]),g.Input([h.Create("style","width:75px"),h.Create("type","range"),h.Create("min","3"),h.Create("max","40"),h.Create("class","slider")],c.brushSize())]),g.Element("tr",[],[g.Element("h2",[],[g.TextNode("Toggle brush types:")]),g.Button("",[h.Create("style","color:#a434b3;"),h.Create("class","fa fa-eraser")],function(){c.set_brushMode(1);}),g.Button("",[h.Create("style","color:#b35034;"),h.Create("class","fa fa-edit")],function(){c.set_brushMode(0);})]),g.Element("tr",[],[g.Button("Create path!",[],function(){var x,y,A,B,C,D,E,F,G,H,I;function z(){y=y+1;}c.set_CachedCanvas(c.ctx().getImageData(0,0,c.canvas().width,c.canvas().height));A=c.CachedCanvas().data;B=i.SplitChars(a.String(A),[","],0);C=j.init(c.canvas().width,c.canvas().height,function(){return{Red:0,Green:0,Blue:0,Alpha:0};});y=0;D=k.step(0,1,c.canvas().width-1);E=l.Get(D);try{while(E.MoveNext()){F=E.Current();G=k.step(0,1,c.canvas().height-1);H=l.Get(G);try{while(H.MoveNext()){I=H.Current();m.get2D(C,F,I).Red=k.toInt(a.Number(m.get(B,y)));z();m.get2D(C,F,I).Green=k.toInt(a.Number(m.get(B,y)));z();m.get2D(C,F,I).Blue=k.toInt(a.Number(m.get(B,y)));z();m.get2D(C,F,I).Alpha=k.toInt(a.Number(m.get(B,y)));z();}}finally{if(typeof H=="object"&&"Dispose"in H)H.Dispose();}}}finally{if(typeof E=="object"&&"Dispose"in E)E.Dispose();}n.log(a.String(A));n.log(C);n.log(c.autoPathfind().Get());})]),g.Element("tr",[],[g.Element("h3",[h.Create("style","text-align: center;")],[g.TextNode("Auto pathfind:")]),g.CheckBox([h.Create("style","text-align: center;\r\n                    vertical-align: middle;\r\n                    margin-left: 50px;")],c.autoPathfind())])])]),g.Element("br",[],[]),g.Element("div",[],[g.Element("h1",[],[g.TextNode("Edit map")]),g.Element("table",[],[g.Element("tr",[],[g.Element("td",[],[g.Element("h3",[],[g.TextNode("Map Size:")]),g.Input([h.Create("style","width:100px"),h.Create("type","range"),h.Create("min","100"),h.Create("max","800"),h.Create("class","slider")],c.MapSize())]),g.Element("td",[],[g.Button("Reset/Clear",[h.Create("style","background: red;color:white;")],function(){c.canvas().height=k.toInt(a.Number(c.MapSize().Get()));c.canvas().width=k.toInt(a.Number(c.MapSize().Get()));c.ctx().lineCap="round";c.draw();})])])])])]);};c.Canvas=function(){var x,y,z,A,B,C,D,E;function F(K,L){var M,N,O;M=c.getXYFromMouseEvent(K,L);N=M[1];O=M[0];c.updatePos(O,N);(c.lastX())[0]=O;(c.lastY())[0]=N;(c.inLine())[0]=true;c.ctx().beginPath();c.ctx().strokeStyle="#000000";c.ctx().fillStyle="#000000";return c.draw();}function G(K,L){var M;(c.inLine())[0]=false;M=c.getXYFromMouseEvent(K,L);return c.updatePos(M[0],M[1]);}function H(K,L){var M,N,O,P,Q;M=c.getXYFromMouseEvent(K,L);N=M[1];O=M[0];c.updatePos(O,N);return(c.inLine())[0]?(c.ctx().moveTo((c.lastX())[0],(c.lastY())[0]),c.ctx().lineTo(O,N),c.ctx().lineWidth=a.Number(c.brushSize().Get()),c.brushMode()===0?c.ctx().stroke():void 0,c.brushMode()===1?(P=20,Q=a.Number(c.brushSize().Get())+P,c.ctx().clearRect(O+P-Q,N+P-Q,Q,Q)):void 0,c.brushMode()===2?(c.clearStart(),c.set_startX(O),c.set_startY(N)):void 0,c.brushMode()===3?(c.clearEnd(),c.set_endX(O),c.set_endY(N)):void 0,(c.lastX())[0]=O,(c.lastY())[0]=N,c.draw()):null;}function I(K,L){var M;M=c.getXYFromMouseEvent(K,L);return c.updatePos(M[0],M[1]);}function J(K,L){(c.inLine())[0]=false;}c.draw();c.ctx().scale(1,1);return q.add((x=[r.Attr().NewAttr("style","\r\n        text-align: center; \r\n        -ms-interpolation-mode: nearest-neighbor;\r\n        image-rendering: pixelated;\r\n        cursor: crosshair")],s.Tags().NewTag("div",x)),[c.labelPos(),s.Tags().NewTag("br",[]),(y=(z=(A=(B=(C=q.add(c.element(),[r.Attr().NewAttr("style","border: 1px solid gray")]),(function(K){t.Events().OnMouseDown(function(L){return function(M){return F(L,M);};},K);}(C),C)),(function(K){t.Events().OnMouseUp(function(L){return function(M){return G(L,M);};},K);}(B),B)),(function(K){t.Events().OnMouseMove(function(L){return function(M){return H(L,M);};},K);}(A),A)),(function(K){t.Events().OnMouseEnter(function(L){return function(M){return I(L,M);};},K);}(z),z)),(function(K){t.Events().OnMouseLeave(function(L){return function(M){return J(L,M);};},K);}(y),y)),(D=[(E=[s.Tags().text("Draw with your mouse")],s.Tags().NewTag("b",E))],s.Tags().NewTag("p",D))]);};c.draw=function(){c.drawStart();c.drawEnd();};c.clearEnd=function(){c.ctx().clearRect(c.endX(),c.endY(),c.BorderSize(),c.BorderSize());};c.drawEnd=function(){c.ctx().fillStyle="#0000ff";c.ctx().fillRect(c.endX(),c.endY(),c.BorderSize(),c.BorderSize());};c.clearStart=function(){c.ctx().clearRect(c.startX(),c.startY(),c.BorderSize(),c.BorderSize());};c.drawStart=function(){c.ctx().fillStyle="#00ff00";c.ctx().fillRect(c.startX(),c.startY(),c.BorderSize(),c.BorderSize());};c.ctx=function(){d.$cctor();return d.ctx;};c.canvas=function(){d.$cctor();return d.canvas;};c.getXYFromMouseEvent=function(x,y){var z;z=a.jQuery(x.get_Body()).position();return[y.X-k.toInt(z.left),y.Y-k.toInt(z.top)];};c.updatePos=function(x,y){var z,A;z=c.labelPos();z.HtmlProvider.Clear(z.get_Body());A=c.labelPos();A.HtmlProvider.AppendNode(A.get_Body(),A.HtmlProvider.CreateTextNode("X="+a.String(x)+", Y="+a.String(y)));};c.labelPos=function(){d.$cctor();return d.labelPos;};c.inLine=function(){d.$cctor();return d.inLine;};c.lastX=function(){d.$cctor();return d.lastX;};c.lastY=function(){d.$cctor();return d.lastY;};c.element=function(){d.$cctor();return d.element;};c.MapSize=function(){d.$cctor();return d.MapSize;};c.CachedCanvas=function(){d.$cctor();return d.CachedCanvas;};c.set_CachedCanvas=function(x){d.$cctor();d.CachedCanvas=x;};c.autoPathfind=function(){d.$cctor();return d.autoPathfind;};c.brushMode=function(){d.$cctor();return d.brushMode;};c.set_brushMode=function(x){d.$cctor();d.brushMode=x;};c.brushSize=function(){d.$cctor();return d.brushSize;};c.endY=function(){d.$cctor();return d.endY;};c.set_endY=function(x){d.$cctor();d.endY=x;};c.endX=function(){d.$cctor();return d.endX;};c.set_endX=function(x){d.$cctor();d.endX=x;};c.startY=function(){d.$cctor();return d.startY;};c.set_startY=function(x){d.$cctor();d.startY=x;};c.startX=function(){d.$cctor();return d.startX;};c.set_startX=function(x){d.$cctor();d.startX=x;};c.BorderSize=function(){d.$cctor();return d.BorderSize;};c.initialOffset=function(){d.$cctor();return d.initialOffset;};c.initialSize=function(){d.$cctor();return d.initialSize;};d.$cctor=function(){var x,y;d.$cctor=a.ignore;d.initialSize=500;d.initialOffset=25;d.BorderSize=12;d.startX=c.initialOffset();d.startY=c.initialOffset();d.endX=c.initialSize()-c.initialOffset();d.endY=c.initialSize()-c.initialOffset();d.brushSize=u.Create$1(a.String(15));d.brushMode=0;d.autoPathfind=u.Create$1(false);d.CachedCanvas=null;d.MapSize=u.Create$1(a.String(c.initialSize()));d.element=s.Tags().NewTag("canvas",[]);x=[[0],[0],[false]];d.lastY=x[1];d.lastX=x[0];d.inLine=x[2];d.labelPos=(y=[s.Tags().text("Position:")],s.Tags().NewTag("span",y));d.canvas=c.element().Dom;c.canvas().height=k.toInt(a.Number(c.MapSize().Get()));c.canvas().width=k.toInt(a.Number(c.MapSize().Get()));d.ctx=c.canvas().getContext("2d");c.ctx().lineCap="round";};w.OnLoad(function(){c.Canvas();});}());
